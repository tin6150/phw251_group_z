---
title: "milestone4_groupZ"
output: pdf_document
date: '2022-11-19'
author:   'Aubrey Robinson, Elizabeth Guzman, Tin Ho (Group Z)'
---

# Project and Milestone overview

[Pasted to group's gdoc:](https://docs.google.com/document/d/1u4-f0KCUB0QGxWI1VVgfEgEaTmQbt-Jk1uIgWP-0VYk/edit#)


# R setup and load libraries

(this code block omitted for brevity)

```{r load-lib, include=FALSE, echo=FALSE}
library(tidyverse)
library(dplyr)
library(kableExtra)
library(lubridate)

# omit warning messages from library load
# https://stackoverflow.com/questions/45399587/how-to-remove-warning-messages-in-r-markdown-document
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 

```

## Loading & Cleaning data from Milestone 4

**Suggestions from Lauren: 
  -confirm we're not double counting deaths in mortality data 
  -summarize mortality rates by county and use rates instead of counts before joining 


```{r massage mortality data, echo=FALSE, include=FALSE}

# Loading Mortality Data 

mortality_path <- 'data/ca_county_mortality.csv'
mortality_data_raw <- read_csv(mortality_path, 
                           na= c("", "NA", "-"),
                           show_col_types=F)

mortality_data <- mortality_data_raw %>% mutate_all(~replace( ., is.na(.), 0))

# View(mortality_data)
# There are NA values in mortality_data, so we need to replace NA w/ 0


# subset mortality data for chronic conditions only

chronic_desc = c( 
  "Chronic lower respiratory diseases",
  "Diabetes mellitus",
  "Diseases of heart",
  "Essential hypertension and hypertensive renal disease",
  "Chronic liver disease and cirrhosis",
  "Alzheimer's disease",
  "Malignant neoplasms",
  "Nephritis, nephrotic syndrome and nephrosis",
  "Cerebrovascular diseases",
  "Parkinson's disease"
  )

chronic_mortality_data = mortality_data %>% 
  filter( Cause_Desc %in% chronic_desc )

num_rows_befor_filter = mortality_data %>% tally
num_rows_after_filter = chronic_mortality_data %>% tally
#num_rows_after_filter

num_rows_filtered = num_rows_befor_filter - num_rows_after_filter
num_rows_filtered
```

```{r massage funding data, echo=FALSE, include=FALSE}



# Loading HCAI funding Data 

funding_path = 'data/hcai_healthcare_construction.csv'
funding_data <- read_csv(  funding_path, 
                           na= c("", "NA", "-"),
                           show_col_types=F       )

CtyColl = select(funding_data, c("Collection of Counties")) %>%
  unique()

CtyColl 
## there are 4 collection of counties, 
## there aren't likely needed for data eval,
## but add lots of NA, so dropping them
#1 Bay Area Counties           
#2 NA                          
#3 Greater Sacramento Counties 
#4 Greater Los Angeles Counties

# finding where in the data frame there is an 'na'
# https://www.geeksforgeeks.org/find-columns-and-rows-with-na-in-r-dataframe/
## funding_data_no_CtyColl = select(funding_data, -c("Collection of Counties"))
funding_data = select(funding_data, -c("Collection of Counties"))

## which(is.na(funding_data_no_CtyColl), arr.ind=T)
# above returns 0 rows, ie
# we find that only the column "Collection of Counties" has 'na'
# we will leave this for now since it may just be a colloquial reference
# unimportant for our data analysis.
# no replacement for na with 0 will be done on this data frame.



# the Costs column has human data, eg $50,890,315.00
# and we need to strip the dollar sign, the commas, 
# and convert them to numbers.  
# ref: https://stackoverflow.com/questions/31944103/convert-currency-with-commas-into-numeric
# we create a new column for this called "Numeric_Cost", 
# but could have potentially done an in-place replacement
funding_data = funding_data %>% 
  mutate(Numeric_Cost = as.numeric(
    gsub( '[$,]', '', funding_data[["Total Costs of OSHPD Projects"]] ) 
  ))

funding_data = funding_data %>%
  mutate( county_name = str_sub( County, 6 )) %>%
  subset(select = -c(County)) %>%
  rename(County = county_name)


# subset HCAI funding data for those "In Closure" state

funding_data <- funding_data %>%
  filter(`OSHPD Project Status` == "In Closure") %>%
  filter(`Data Generation Date` == as_date("2022-08-11")  )


  ## is 2022-08-11 the latest avail data? ++CHECK++

    #group_by(County, Numeric_Cost, `OSHPD Project Status`) %>%  
  ## I (Tin) can no longer get the the gruop_by  to work... 

funding_data %>% arrange( Numeric_Cost ) %>% head( 10 )


#### Not sure why instruction team want us to focus on "In Closure"
#### maybe stop the project from closing and fund it further?
#### but if cost is 0 means there isn't actually any project?

```


```{r massage demographics data, echo=FALSE, include=FALSE}


# Load demographics data

demographics_path = 'data/ca_county_demographics.csv'
demographics_data = read_csv( demographics_path, 
                              na = c("", "NA", "-"), 
                              show_col_types=F )

# the first column contains id number, but it is unamed, so renaming it
# rest of the columns have reasonable names, so left them as is.
demographics_data = rename( demographics_data, id="...1")

# View(demographics_data)


# massaging demographics data

demographics_data <- demographics_data %>%
  select(id, name, pop2012, pop12_sqmi, med_age, owner_occ, renter_occ)

## Determining Renters vs Homeowners Ratio
demographics_data = demographics_data %>%
  mutate( rent_own_ratio = renter_occ / owner_occ )


demographics_data <- 
  mutate(demographics_data, 
         rural_class=if_else( pop12_sqmi < 20, "rural", "not rural", missing=NULL))

# column to show whether county was rural or not
rural_not_rural <- demographics_data %>% 
  select( name, rural_class, rent_own_ratio )  

rural_counties = rural_not_rural   %>%
  filter( rural_class == "rural" ) %>%
  arrange( desc( rent_own_ratio  ) ) %>%
  rename( `County` = name,
          `Class`  = rural_class,
          `Rent vs Own Ratio` = rent_own_ratio )



```
```{r tmp}

## decide if need to output any of these tables
## likely need to refine further 
rural_counties %>% head( 6 )

```

```{r join tables, echo=FALSE, include=FALSE}


## NOTE: should use the chronic_mortality subset.

```

\newpage 

#Visualizations

Data needed to make decision:
-which counties share all 3 attributes: low pop(rural), high median age, 
& high proportion of renters vs homeowners
-which 5 counties have highest mortality rates due to chronic illness
-what counties have received little to no funding recently? ---not quite sure 
about this one

#Print Quality Table

```{r}

```

#Print Quality Plot or Chart

```{r}

```

#Print Quality Table, Plot or Chart

```{r}

```

